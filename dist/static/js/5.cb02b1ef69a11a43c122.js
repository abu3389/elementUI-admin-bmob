webpackJsonp([5],{V0XR:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=i("BO1k"),o=i.n(l),n={data:function(){return{tableData:[],editVisible:!1,delVisible:!1,form:{type:"",objectId:"",url:"",img:"",link:""},loading:!0}},components:{},created:function(){this.loading=!0,setTimeout(this.getData,1e3)},methods:{getData:function(){var t=this;Bmob.Query("banners").find().then(function(e){console.info(e),t.tableData=e,t.loading=!1})},handleEdit:function(t,e){if(e){this.idx=t;var i=this.tableData[t];this.form=i}this.editVisible=!0},handleDelete:function(t,e){this.idx=t,this.delVisible=!0},saveEdit:function(){var t=this,e=this;this.$set(this.tableData,this.idx,this.form);var i=Bmob.Query("banners");if(this.tableData[this.idx].objectId){console.info(this.tableData[this.idx].objectId);var l=this.tableData[this.idx].objectId;i.get(l).then(function(t){console.log(t),t.set("type",e.form.type),t.set("img",e.form.img),t.set("link",e.form.link),t.save()}).catch(function(t){console.log(t)})}else i.set("type",e.form.type),i.set("url",this.form.url),i.set("img",this.form.img),i.set("link",this.form.link),i.save().then(function(t){console.log(t)}).catch(function(e){console.log(e),t.$message.success(e)});this.editVisible=!1,this.$message.success("修改第 "+(this.idx+1)+" 行成功")},iptChange:function(){console.info(this.form.url);var t=this;t.getBase64Image(t.form.url,void 0,void 0,function(e){e?t.form.img=e:t.$message.success("图片转化失败")})},iptUpload:function(){var t=this,e=document.getElementById("profilePhotoFileUpload"),i=e.files,l=void 0,n=!0,a=!1,s=void 0;try{for(var r,c=o()(i);!(n=(r=c.next()).done);n=!0){var d=r.value;l=Bmob.File(d.name,d)}}catch(t){a=!0,s=t}finally{try{!n&&c.return&&c.return()}finally{if(a)throw s}}l.save().then(function(i){console.info(i[0].url),t.form.url=i[0].url,t.iptChange(),e.setAttribute("data-url",i[0].url)})},getBase64Image:function(t,e,i,l){var o=new Image;o.onload=function(){var t,n;l&&l((t=document.createElement("canvas"),n=t.getContext("2d"),t.width=e||o.width,t.height=i||o.height,n.drawImage(o,0,0,t.width,t.height),t.toDataURL()))},o.onerror=function(){l&&l(!1)},o.setAttribute("crossOrigin","Anonymous"),o.src=t}}},a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",{staticClass:"main"},[i("div",{staticClass:"crumbs"},[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",[i("i",{staticClass:"el-icon-news"}),t._v(" banner列表")])],1)],1),t._v(" "),i("div",{staticClass:"container"},[i("div",{staticClass:"select-box"},[i("el-button",{staticStyle:{margin:"20px"},attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(e){return t.handleEdit()}}},[t._v("添加banner图")])],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[i("el-table-column",{attrs:{fixed:"",prop:"type",label:"类型",width:"120"}}),t._v(" "),i("el-table-column",{attrs:{prop:"objectId",label:"objectId",width:"120"}}),t._v(" "),i("el-table-column",{attrs:{prop:"link",label:"链接跳转",width:"200"}}),t._v(" "),i("el-table-column",{attrs:{prop:"url",label:"图片地址",width:"200"}}),t._v(" "),i("el-table-column",{attrs:{label:"图片",width:"250"},scopedSlots:t._u([{key:"default",fn:function(t){return[i("img",{staticStyle:{height:"100px"},attrs:{src:t.row.img,alt:""}})]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"createdAt",label:"创建日期",width:"150"}}),t._v(" "),i("el-table-column",{attrs:{fixed:"right",label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{size:"small"},on:{click:function(i){return t.handleEdit(e.$index,e.row)}}},[t._v("编辑")]),t._v(" "),i("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(i){return t.handleDelete(e.$index,e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),i("el-dialog",{attrs:{title:"编辑",visible:t.editVisible,width:"40%"},on:{"update:visible":function(e){t.editVisible=e}}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"图片类型"}},[i("el-input",{model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"图片链接"}},[i("el-input",{on:{change:function(e){return t.iptChange()}},model:{value:t.form.url,callback:function(e){t.$set(t.form,"url",e)},expression:"form.url"}}),t._v(" "),i("el-input",{attrs:{type:"file","data-url":t.form.url,id:"profilePhotoFileUpload"},on:{change:function(e){return t.iptUpload()}}})],1),t._v(" "),i("el-form-item",{attrs:{label:"图片跳转"}},[i("el-input",{model:{value:t.form.link,callback:function(e){t.$set(t.form,"link",e)},expression:"form.link"}})],1)],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.editVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.saveEdit}},[t._v("确 定")])],1)],1),t._v(" "),i("el-dialog",{attrs:{title:"提示",visible:t.delVisible,width:"300px",center:""},on:{"update:visible":function(e){t.delVisible=e}}},[i("div",{staticClass:"del-dialog-cnt"},[t._v("删除不可恢复，是否确定删除？")]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.delVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.deleteRow(t.tableData[t.idx].objectId)}}},[t._v("确 定")])],1)])],1)])},staticRenderFns:[]};var s=i("VU/8")(n,a,!1,function(t){i("zRik")},"data-v-f0ec1480",null);e.default=s.exports},zRik:function(t,e){}});